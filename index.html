<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol de Amor Animado</title>
    <!-- Autoría y derechos -->
    <meta name="author" content="Zero">
    <meta name="copyright" content="Zero - Código libre no comercial">
    <meta name="description" content="Árbol de Amor Animado: una sorpresa interactiva y romántica para dedicar a tu pareja o ser querido. Código libre para uso personal, educativo o de inspiración.">
    <meta name="keywords" content="amor, sorpresa, romántico, dedicatoria, animación, árbol, corazones, pareja, aniversario, regalo digital">
    <meta name="robots" content="index, follow">
    <!-- Estilos -->
    <link rel="stylesheet" href="Css/style.css">
    <link rel="stylesheet" href="Css/style.mobile.css" media="only screen and (max-width: 600px)">
    <style>
        /**esto permitira que toque en cualquier parte e iniciae el sonido automaticamnete
        /* Pantalla de bloqueo */
    #start-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: black;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      z-index: 9999;
      cursor: pointer;
      text-align: center;
    }

    /* Contenido real (oculto al principio) */
    #main-content {
      display: none;
      padding: 2rem;
    }
      .tree-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        height: 400px;
        z-index: 2;
      }
      .animated-heart {
        transform-origin: center;
        animation: beat 1s infinite;
      }
      @keyframes beat {
        0%, 100% { transform: scale(1); }
        20% { transform: scale(1.1); }
        40% { transform: scale(0.95); }
        60% { transform: scale(1.08); }
        80% { transform: scale(1); }
      }
    </style>
</head>
<body>
    <div id="start-screen">
    Toca en cualquier parte<br>para comenzar
  </div>
    <div id="floating-objects">
        <div class="floating-petal" style="left: 26.029%; top: 101.867%; opacity: 0.2; transition: transform 9798.89ms linear, opacity 1.2s; transform: translate(2.76292px, -110vh) scale(0.960448) rotate(148.288deg);">
        </div>

        <div class="floating-petal" style="left: 56.1927%; top: 106.2%; opacity: 0.2; transition: transform 8610.45ms linear, opacity 1.2s; transform: translate(-12.8402px, -110vh) scale(0.85674) rotate(128.775deg);">
        </div>
        
        <div class="floating-petal" style="left: 42.6563%; top: 101.565%; opacity: 0.2; transition: transform 6048.21ms linear, opacity 1.2s; transform: translate(22.8584px, -110vh) scale(1.29523) rotate(190.72deg);">
        </div>
        
        <div class="floating-petal" style="left: 60.6202%; top: 102.9%; opacity: 0.2; transition: transform 8386.57ms linear, opacity 1.2s; transform: translate(0.624022px, -110vh) scale(0.859116) rotate(286.234deg);">
        </div>
        
        <div class="floating-petal" style="left: 44.6807%; top: 104.405%; opacity: 0.2; transition: transform 6900.79ms linear, opacity 1.2s; transform: translate(20.6994px, -110vh) scale(1.22519) rotate(90.6745deg);">
        </div>
        <div class="floating-petal" style="left: 37.1554%; top: 102.011%; opacity: 0.987509;">
        </div>
    </div>
    <div class="dedication-text typing" id="dedication-text">
        <b>No hay distancia que me aparte,
        ni reloj que me limite;
        te amo en cada instante,
        aunque el abrazo se evite.

        Y aunque duela en el alma,
        aunque me hagas sentir mal,
        mi amor no pierde la calma,
        ni deja de luchar más.

        Porque sigues en mi mente,
        aunque a veces no lo ves,
        yo te elijo, fiel y fuerte,
        una y otra y otra vez.</b>

        <div id="signature" class="signature visible"><b>De:</b> <i style="color: rgb(115, 75, 70);text-shadow: -1px -1px 0 rgb(91, 56, 54),  1px -1px 0 rgb(91, 56, 54),-1px  1px 0 rgb(91, 56, 54),1px  1px 0 rgb(91, 56, 54)">Tu Ángel</i><br><b>Para:</b><i style="color: rgb(115, 75, 70);text-shadow: -1px -1px 0 rgb(91, 56, 54),1px -1px 0 rgb(91, 56, 54),-1px  1px 0 rgb(91, 56, 54),1px  1px 0 rgb(91, 56, 54)">🤍😍Mi Amorcito Lindo😘🩵</i>
        </div>
    </div>
    <div class="countdown visible" id="countdown">Llevamos juntos: <b>86</b> días<br>Nuestro aniversario: <b>278d 14h 9m 7s</b></div>
    <div class="tree-container" id="tree-container"><!--?xml version="1.0" encoding="iso-8859-1"?-->
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" class="move-and-scale">
<!-- Se eliminó el círculo de fondo -->
<!-- <circle style="fill:#FFD15D;" cx="256" cy="256" r="256"/> -->
<!-- Se eliminó el path de fondo -->
<!-- <path style="fill:#F9B54C;" d="M271.694,511.507c123.938-7.497,224.068-103.162,238.501-225.102L351.854,128.062l-12.657,4.834 ..."/> -->
<path style="fill: rgb(115, 75, 70); fill-opacity: 1; stroke-dasharray: 902.684; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1), fill-opacity 0.5s 0.9s;" d="M315.475,225.868c0,0-57.165,80.079,0,210.472H196.525c57.165-130.393,0-210.472,0-210.472h23.387
	l17.008,48.94l6.378-95.713h17.717l9.921,70.158l42.52-46.771L315.475,225.868z"></path>
<path style="fill: rgb(91, 56, 54); fill-opacity: 1; stroke-dasharray: 699.094; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.08s, fill-opacity 0.5s 0.98s;" d="M315.475,225.868l-2.02-23.385l-42.52,46.771l-9.921-70.158h-5.587v257.243h60.049
	C258.31,305.945,315.475,225.868,315.475,225.868z"></path>
<path style="fill: rgb(252, 111, 88); fill-opacity: 1; stroke-dasharray: 260.94; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.16s, fill-opacity 0.5s 1.06s;" d="M199.973,154.215c0-11.807,9.456-21.378,21.118-21.378c11.662,0,21.118,9.571,21.118,21.378
	c0-11.807,9.456-21.378,21.118-21.378c11.662,0,21.118,9.571,21.118,21.378c0,20.442-42.236,44.896-42.236,44.896
	S199.973,175.811,199.973,154.215z"></path>
<g>
	<path style="fill: rgb(244, 227, 195); fill-opacity: 1; stroke-dasharray: 260.941; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.24s, fill-opacity 0.5s 1.14s;" d="M145.627,222.42c-7.697-8.954-6.766-22.375,2.077-29.979c8.844-7.602,22.254-6.508,29.951,2.446
		c-7.697-8.954-6.766-22.375,2.077-29.979c8.844-7.602,22.254-6.508,29.951,2.446c13.326,15.503-2.762,61.578-2.762,61.578
		S159.704,238.795,145.627,222.42z"></path>
	<path style="fill: rgb(244, 227, 195); fill-opacity: 1; stroke-dasharray: 260.945; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.32s, fill-opacity 0.5s 1.22s;" d="M280.007,112.287c5.575-10.409,18.429-14.383,28.71-8.875c10.281,5.506,14.096,18.408,8.523,28.817
		c5.575-10.409,18.429-14.383,28.71-8.875c10.281,5.506,14.096,18.408,8.523,28.817c-9.652,18.022-58.428,19.635-58.428,19.635
		S269.812,131.324,280.007,112.287z"></path>
	<path style="fill: rgb(244, 227, 195); fill-opacity: 1; stroke-dasharray: 260.95; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.4s, fill-opacity 0.5s 1.3s;" d="M290.756,208.879c7.432-9.173,20.806-10.657,29.87-3.315c9.064,7.342,10.388,20.73,2.955,29.903
		c7.432-9.173,20.806-10.657,29.87-3.315c9.064,7.342,10.388,20.73,2.955,29.903c-12.869,15.882-61.087,8.292-61.087,8.292
		S277.163,225.656,290.756,208.879z"></path>
</g>
<path style="fill: rgb(252, 111, 88); fill-opacity: 1; stroke-dasharray: 163.846; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.48s, fill-opacity 0.5s 1.38s;" d="M143.463,198.958c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045
	c-2.131-7.099,1.831-14.558,8.849-16.662s14.433,1.946,16.563,9.045c3.687,12.29-17.311,34.607-17.311,34.607
	S147.359,211.94,143.463,198.958z"></path>
<path style="fill: rgb(244, 227, 195); fill-opacity: 1; stroke-dasharray: 163.846; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.56s, fill-opacity 0.5s 1.46s;" d="M147.854,129.436c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045
	c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045c3.687,12.29-17.311,34.607-17.311,34.607
	S151.749,142.419,147.854,129.436z"></path>
<g>
	<path style="fill: rgb(193, 50, 31); fill-opacity: 1; stroke-dasharray: 163.846; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.64s, fill-opacity 0.5s 1.54s;" d="M228.131,110.166c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045
		c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045c3.687,12.29-17.311,34.607-17.311,34.607
		S232.027,123.151,228.131,110.166z"></path>
	<path style="fill: rgb(193, 50, 31); fill-opacity: 1; stroke-dasharray: 163.843; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.72s, fill-opacity 0.5s 1.62s;" d="M162.864,292.717c-6.87-2.782-10.206-10.542-7.452-17.33c2.753-6.789,10.554-10.035,17.422-7.252
		c-6.87-2.782-10.206-10.542-7.452-17.33c2.753-6.789,10.554-10.035,17.422-7.252c11.893,4.818,16.15,35.166,16.15,35.166
		S175.428,297.806,162.864,292.717z"></path>
	<path style="fill: rgb(193, 50, 31); fill-opacity: 1; stroke-dasharray: 163.846; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.8s, fill-opacity 0.5s 1.7s;" d="M199.687,223.944c-2.131-7.099,1.831-14.558,8.849-16.662c7.018-2.103,14.433,1.946,16.563,9.045
		c-2.131-7.099,1.831-14.558,8.849-16.662s14.433,1.946,16.563,9.045c3.687,12.29-17.311,34.607-17.311,34.607
		S203.583,236.928,199.687,223.944z"></path>
	<path style="fill: rgb(193, 50, 31); fill-opacity: 1; stroke-dasharray: 163.847; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.88s, fill-opacity 0.5s 1.78s;" d="M357.981,169.91c5.665-4.779,14.086-4.11,18.806,1.491c4.722,5.601,3.956,14.015-1.71,18.794
		c5.665-4.779,14.086-4.11,18.806,1.491c4.722,5.601,3.956,14.015-1.71,18.794c-9.809,8.273-38.64-2.117-38.64-2.117
		S347.619,178.65,357.981,169.91z"></path>
</g>
<path style="fill: rgb(252, 111, 88); fill-opacity: 1; stroke-dasharray: 163.822; stroke-dashoffset: 0; transition: stroke-dashoffset 1.2s cubic-bezier(0.77, 0, 0.18, 1) 0.96s, fill-opacity 0.5s 1.86s;" d="M292.404,176.175c3.415-6.577,11.452-9.173,17.953-5.798s9,11.443,5.587,18.02
	c3.415-6.577,11.452-9.173,17.953-5.797c6.501,3.375,9.001,11.443,5.587,18.02c-5.913,11.388-36.523,12.786-36.523,12.786
	S286.158,188.202,292.404,176.175z"></path>
</svg></div>
<button id="music-btn" style="position: fixed; bottom: 18px; right: 18px; z-index: 99; background: rgba(255, 255, 255, 0.85); border: none; border-radius: 24px; padding: 10px 18px; font-size: 1.1em; cursor: pointer;">▶️ Música</button></body>
    <audio src="Music/Ed Sheeran - Perfect.mp3" id="bg-music" preload="auto"></audio>

<script>
  // Función que contiene todo el código original con la animación de la dedicatoria incluida
function startAnimations() {
  fetch('Img/treelove.svg')
    .then(res => res.text())
    .then(svgText => {
      const container = document.getElementById('tree-container');
      container.innerHTML = svgText;
      const svg = container.querySelector('svg');
      if (!svg) return;

      // Animación de "dibujo" para todos los paths
      const allPaths = Array.from(svg.querySelectorAll('path'));
      allPaths.forEach(path => {
        path.style.stroke = '#222';
        path.style.strokeWidth = '2.5';
        path.style.fillOpacity = '0';
        const length = path.getTotalLength();
        path.style.strokeDasharray = length;
        path.style.strokeDashoffset = length;
        path.style.transition = 'none';
      });

      // Forzar reflow y luego animar
      setTimeout(() => {
        allPaths.forEach((path, i) => {
          path.style.transition = `stroke-dashoffset 1.2s cubic-bezier(.77,0,.18,1) ${i * 0.08}s, fill-opacity 0.5s ${0.9 + i * 0.08}s`;
          path.style.strokeDashoffset = 0;
          setTimeout(() => {
            path.style.fillOpacity = '1';
            path.style.stroke = '';
            path.style.strokeWidth = '';
          }, 1200 + i * 80);
        });

        // Después de la animación de dibujo, mueve y agranda el SVG
        const totalDuration = 1200 + (allPaths.length - 1) * 80 + 500;
        setTimeout(() => {
          svg.classList.add('move-and-scale');
          // Mostrar texto con efecto typing
          setTimeout(() => {
            showDedicationText();
            // Mostrar petalos flotando
            startFloatingObjects();
            // Mostrar cuenta regresiva
            showCountdown();
            // Iniciar música de fondo
            playBackgroundMusic();
          }, 1200); //Tiempo para agrandar el SVG
        }, totalDuration);
      }, 50);

      // Selecciona los corazones (formas rojas)
      const heartPaths = allPaths.filter(el => {
        const style = el.getAttribute('style') || '';
        return style.includes('#FC6F58') || style.includes('#C1321F');
      });
      heartPaths.forEach(path => {
        path.classList.add('animated-heart');
      });
    });
}

// Efecto máquina de escribir para el texto de dedicatoria
function getURLParam(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

function showDedicationText() {
  let text = getURLParam('text');
  if (!text) {
    text = `Para el amor de mi vida:\n\nDesde el primer momento supe que eras tú. Tu sonrisa, tu voz, tu forma de ser… todo en ti me hace sentir en casa.\n\nGracias por acompañarme en cada paso, por entenderme incluso en silencio, y por llenar mis días de amor.\n\nTe amo más de lo que las palabras pueden expresar.`;  
  } else {
    text = decodeURIComponent(text).replace(/\\n/g, '\n');
  }
  const container = document.getElementById('dedication-text');
  container.classList.add('typing');  // Agregar la clase 'typing' para iniciar la animación

  let i = 0;
  function type() {
    if (i <= text.length) {
      container.textContent = text.slice(0, i);
      i++;
      setTimeout(type, text[i - 2] === '\n' ? 350 : 45);
    } else {
      setTimeout(showSignature, 600);
    }
  }
  type();
}

// Firma manuscrita animada
function showSignature() {
  const dedication = document.getElementById('dedication-text');
  let signature = dedication.querySelector('#signature');
  if (!signature) {
    signature = document.createElement('div');
    signature.id = 'signature';
    signature.className = 'signature';
    dedication.appendChild(signature);
  }
  let firma = getURLParam('firma');
  signature.textContent = firma ? decodeURIComponent(firma) : "Con amor, Zero";
  signature.classList.add('visible');
}

// Controlador de objetos flotantes
function startFloatingObjects() {
  const container = document.getElementById('floating-objects');
  let count = 0;
  function spawn() {
    let el = document.createElement('div');
    el.className = 'floating-petal';
    el.style.left = `${Math.random() * 90 + 2}%`;
    el.style.top = `${100 + Math.random() * 10}%`;
    el.style.opacity = 0.7 + Math.random() * 0.3;
    container.appendChild(el);

    const duration = 6000 + Math.random() * 4000;
    const drift = (Math.random() - 0.5) * 60;
    setTimeout(() => {
      el.style.transition = `transform ${duration}ms linear, opacity 1.2s`;
      el.style.transform = `translate(${drift}px, -110vh) scale(${0.8 + Math.random() * 0.6}) rotate(${Math.random() * 360}deg)`;
      el.style.opacity = 0.2;
    }, 30);

    setTimeout(() => {
      if (el.parentNode) el.parentNode.removeChild(el);
    }, duration + 2000);

    if (count++ < 32) setTimeout(spawn, 350 + Math.random() * 500);
    else setTimeout(spawn, 1200 + Math.random() * 1200);
  }
  spawn();
}

// Cuenta regresiva o fecha especial
function showCountdown() {
  const container = document.getElementById('countdown');
  let startParam = getURLParam('start');
  let eventParam = getURLParam('event');
  let startDate = startParam ? new Date(startParam + 'T00:00:00') : new Date('2024-08-03T00:00:00'); 
  let eventDate = eventParam ? new Date(eventParam + 'T00:00:00') : new Date('2025-08-03T00:00:00');

  function update() {
    const now = new Date();
    let diff = now - startDate;
    let days = Math.floor(diff / (1000 * 60 * 60 * 24));
    let eventDiff = eventDate - now;
    let eventDays = Math.max(0, Math.floor(eventDiff / (1000 * 60 * 60 * 24)));
    let eventHours = Math.max(0, Math.floor((eventDiff / (1000 * 60 * 60)) % 24));
    let eventMinutes = Math.max(0, Math.floor((eventDiff / (1000 * 60)) % 60));
    let eventSeconds = Math.max(0, Math.floor((eventDiff / 1000) % 60));

    container.innerHTML =
      `Llevamos juntos: <b>${days}</b> días<br>` +
      `Nuestro aniversario: <b>${eventDays}d ${eventHours}h ${eventMinutes}m ${eventSeconds}s</b>`;
    container.classList.add('visible');
  }
  update();
  setInterval(update, 1000);
}

// --- Música de fondo ---
function playBackgroundMusic() {
  const audio = document.getElementById('bg-music');
  if (!audio) return;

  let musicaParam = getURLParam('musica');
  if (musicaParam) {
    musicaParam = decodeURIComponent(musicaParam).replace(/[^\w\d .\-]/g, '');
    audio.src = 'Music/' + musicaParam;
  } else {
    audio.src = 'Music/Ed Sheeran - Perfect.mp3';
  }

  let btn = document.getElementById('music-btn');
  if (!btn) {
    btn = document.createElement('button');
    btn.id = 'music-btn';
    btn.textContent = '🔊 Música';
    btn.style.position = 'fixed';
    btn.style.bottom = '18px';
    btn.style.right = '18px';
    btn.style.zIndex = 99;
    btn.style.background = 'rgba(255,255,255,0.85)';
    btn.style.border = 'none';
    btn.style.borderRadius = '24px';
    btn.style.padding = '10px 18px';
    btn.style.fontSize = '1.1em';
    btn.style.cursor = 'pointer';
    document.body.appendChild(btn);
  }

  audio.volume = 0.7;
  audio.loop = true;

  audio.play().then(() => {
    btn.textContent = '🔊 Música';
  }).catch(() => {
    btn.textContent = '▶️ Música';
  });

  btn.onclick = () => {
    if (audio.paused) {
      audio.play();
      btn.textContent = '🔊 Música';
    } else {
      audio.pause();
      btn.textContent = '🔈 Música';
    }
  };
}

// Esperar a que se haga clic o toque
document.getElementById('start-screen').addEventListener('click', () => {
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  startAnimations();
});

document.getElementById('start-screen').addEventListener('touchstart', () => {
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('main-content').style.display = 'block';
  startAnimations();
});

</script>
</body>
</html>